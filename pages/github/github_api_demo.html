<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub API åŠŸèƒ½æµ‹è¯•é¡µé¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            margin: 0;
        }

        .main-layout {
            display: flex;
            gap: 20px;
            max-width: 1600px;
            margin: 0 auto;
            align-items: flex-start;
        }

        .left-content {
            flex: 1;
            min-width: 0;
        }

        .right-sidebar {
            width: 400px;
            position: sticky;
            top: 20px;
            max-height: calc(100vh - 40px);
            display: flex;
            flex-direction: column;
        }

        .container {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .log-sidebar {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        h1 {
            color: #2563eb;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .subtitle {
            color: #64748b;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            border: 2px solid #e2e8f0;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: #2563eb;
            border-radius: 2px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #475569;
            margin-bottom: 6px;
        }

        input, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
            font-family: inherit;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
            font-family: 'Monaco', 'Courier New', monospace;
        }

        .button-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: #2563eb;
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-secondary {
            background: #64748b;
            color: white;
        }

        .btn-secondary:hover {
            background: #475569;
        }

        .log-container {
            background: #1e293b;
            color: #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            overflow-y: auto;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.6;
            flex: 1;
        }

        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .log-title {
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            border-bottom: 2px solid #e2e8f0;
            overflow-x: auto;
        }

        .tab {
            padding: 12px 24px;
            border: none;
            background: transparent;
            color: #64748b;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .tab:hover {
            color: #2563eb;
            background: #eff6ff;
            transform: none;
            box-shadow: none;
        }

        .tab.active {
            color: #2563eb;
            border-bottom-color: #2563eb;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid #334155;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-time {
            color: #94a3b8;
            margin-right: 8px;
        }

        .log-success {
            color: #34d399;
        }

        .log-error {
            color: #f87171;
        }

        .log-info {
            color: #60a5fa;
        }

        .log-warning {
            color: #fbbf24;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 12px;
        }

        .status-success {
            background: #dcfce7;
            color: #15803d;
        }

        .status-error {
            background: #fee2e2;
            color: #dc2626;
        }

        .status-pending {
            background: #fef3c7;
            color: #b45309;
        }

        .result-box {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .token-input-group {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .token-input-group .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .token-input-group button {
            flex-shrink: 0;
            margin-bottom: 0;
        }

        @media (max-width: 1200px) {
            .right-sidebar {
                width: 350px;
            }
        }

        @media (max-width: 992px) {
            .main-layout {
                flex-direction: column;
            }
            
            .right-sidebar {
                width: 100%;
                position: relative;
                top: 0;
                max-height: 500px;
                order: 2;
            }
            
            .left-content {
                order: 1;
            }
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .right-sidebar {
                max-height: 400px;
            }
            
            .token-input-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .token-input-group .form-group {
                margin-bottom: 16px;
            }
            
            .token-input-group button {
                width: 100%;
            }
        }

        .hint {
            background: #eff6ff;
            border-left: 4px solid #2563eb;
            padding: 12px;
            border-radius: 4px;
            font-size: 13px;
            color: #1e40af;
            margin-bottom: 16px;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f4f6;
            border-radius: 50%;
            border-top-color: #2563eb;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="main-layout">
        <!-- å·¦ä¾§ä¸»å†…å®¹åŒº -->
        <div class="left-content">
            <div class="container">
                <h1>ğŸ§ª GitHub API åŠŸèƒ½æµ‹è¯•</h1>
                <p class="subtitle">å®Œæ•´æµ‹è¯• github_api.js çš„æ‰€æœ‰å¢åˆ æ”¹æŸ¥åŠŸèƒ½</p>

                <!-- Tab æ ‡ç­¾é¡µ -->
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('config')">âš™ï¸ é…ç½®ä¿¡æ¯</button>
                    <button class="tab" onclick="switchTab('files')">ğŸ“ ç›®å½•æ–‡ä»¶</button>
                    <button class="tab" onclick="switchTab('read')">ğŸ“– æ–‡ä»¶å†…å®¹</button>
                    <button class="tab" onclick="switchTab('download')">ğŸ“¦ ä¸‹è½½æ–‡ä»¶</button>
                    <button class="tab" onclick="switchTab('write')">âœï¸ åˆ›å»º/æ›´æ–°</button>
                    <button class="tab" onclick="switchTab('delete')">ğŸ—‘ï¸ åˆ é™¤æ–‡ä»¶</button>
                    <button class="tab" onclick="switchTab('sync')">ğŸ”„ åŒæ­¥åŠŸèƒ½</button> 
                    <button class="tab" onclick="switchTab('test')">ğŸ¯ ç»¼åˆæµ‹è¯•</button>
                </div>

                <!-- é…ç½® Tab -->
                <div id="tab-config" class="tab-content active">
                    <div class="section">
                        <div class="hint">
                            ğŸ’¡ é¦–å…ˆå¡«å†™ Access Token å¹¶æµ‹è¯•è¿æ¥ï¼Œè¿æ¥æˆåŠŸåä¼šè‡ªåŠ¨å¼¹å‡ºä»“åº“é…ç½®ã€‚
                        </div>
                        <div class="token-input-group">
                            <div class="form-group">
                                <label>Access Token *</label>
                                <input type="password" id="accessToken" placeholder="ghp_xxxxxxxxxxxx" />
                            </div>
                            <button class="btn-secondary" onclick="testConnection()" style="height: 42px;">
                                ğŸ”— æµ‹è¯•è¿æ¥
                            </button>
                        </div>
                        <div class="button-group" style="margin-top: 16px;">
                            <button class="btn-secondary" onclick="loadSavedConfig()">
                                ğŸ“¥ åŠ è½½å·²ä¿å­˜é…ç½®
                            </button>
                        </div>
                        
                        <div id="repoSection" style="display: none; margin-top: 24px;">
                            <div class="section-title" style="margin-bottom: 16px;">ğŸ“‹ ä»“åº“é…ç½®</div>
                            <div class="hint">
                                ğŸ”— å¯ä»¥è¾“å…¥ä»“åº“ URL ï¼ˆå¦‚ï¼šhttps://github.com/owner/repoï¼‰ä¸€é”®è§£æ
                            </div>
                            <div class="form-group">
                                <label>ä»“åº“ URL ï¼ˆå¯é€‰ï¼‰</label>
                                <div style="display: flex; gap: 12px;">
                                    <input type="text" id="repoUrl" placeholder="https://github.com/owner/repo" style="flex: 1;" />
                                    <button class="btn-primary" onclick="parseRepoUrl()" style="white-space: nowrap;">
                                        ğŸ§© è§£æ URL
                                    </button>
                                </div>
                            </div>
                            <div class="grid-2">
                                <div class="form-group">
                                    <label>ä»“åº“æ‰€æœ‰è€… *</label>
                                    <input type="text" id="owner" placeholder="username" />
                                </div>
                                <div class="form-group">
                                    <label>ä»“åº“åç§° *</label>
                                    <input type="text" id="repo" placeholder="my-repo" />
                                </div>
                                <div class="form-group">
                                    <label>åˆ†æ”¯åç§°</label>
                                    <input type="text" id="branch" placeholder="master" value="master" />
                                </div>
                                <div class="form-group">
                                    <label>é»˜è®¤æ–‡ä»¶è·¯å¾„</label>
                                    <input type="text" id="filePath" placeholder="README.md" value="README.md" />
                                </div>
                            </div>
                            <div class="button-group" style="margin-top: 12px;">
                                <button class="btn-success" onclick="saveCurrentConfig()">
                                    ğŸš€ ä¿å­˜é…ç½®
                                </button>
                                <button class="btn-primary" onclick="listUserRepos()">
                                    ğŸ“š æŸ¥çœ‹æˆ‘çš„ä»“åº“
                                </button>
                                <button class="btn-primary" onclick="listRepoBranches()">
                                    ğŸŒ¿ æŸ¥çœ‹åˆ†æ”¯åˆ—è¡¨
                                </button>
                            </div>
                            <div id="repoListResult" class="result-box" style="display: none; margin-top: 12px;"></div>
                        </div>
                    </div>
                </div>

                <!-- æ–‡ä»¶æµè§ˆ Tab -->
                <div id="tab-files" class="tab-content">
                    <div class="section">
                        <p style="font-size: 13px; color: #64748b; margin-bottom: 12px;">
                            æµè§ˆå½“å‰é…ç½®ä»“åº“çš„æ–‡ä»¶å’Œç›®å½•åˆ—è¡¨
                        </p>
                        <div class="hint">
                            ğŸ’¡ æç¤ºï¼šç•™ç©ºè·¯å¾„å³æŸ¥çœ‹æ ¹ç›®å½•ï¼Œè¾“å…¥ç›®å½•è·¯å¾„å¯æŸ¥çœ‹å­ç›®å½•å†…å®¹ï¼ˆå¦‚ï¼šsrc/componentsï¼‰
                        </div>
                        <div class="form-group">
                            <label>ç›®å½•è·¯å¾„ï¼ˆå¯é€‰ï¼‰</label>
                            <input type="text" id="filesPath" placeholder="ç•™ç©ºæŸ¥çœ‹æ ¹ç›®å½•ï¼Œå¦‚ï¼šsrc/components" />
                        </div>
                        <div class="button-group">
                            <button class="btn-primary" onclick="browseRepoFiles()">
                                ğŸ“ æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨
                            </button>
                        </div>
                        <div id="filesResult" class="result-box" style="display: none;"></div>
                    </div>
                </div>

                <!-- æŸ¥è¯¢ Tab -->
                <div id="tab-read" class="tab-content">
                    <div class="section">
                        <p style="font-size: 13px; color: #64748b; margin-bottom: 12px;">
                            ä» GitHub ä»“åº“è·å–æ–‡ä»¶å†…å®¹
                        </p>
                        <div class="form-group">
                            <label>æ–‡ä»¶è·¯å¾„</label>
                            <input type="text" id="getFilePath" placeholder="è¾“å…¥æ–‡ä»¶è·¯å¾„ï¼Œå¦‚: prompts_data.json" />
                        </div>
                        <div class="button-group">
                            <button class="btn-success" onclick="testGetFile()">
                                ğŸ“¥ è·å–æ–‡ä»¶
                            </button>
                        </div>
                        <div id="getFileResult" class="result-box" style="display: none;"></div>
                    </div>
                </div>

                <!-- ä¸‹è½½æ–‡ä»¶ Tab -->
                <div id="tab-download" class="tab-content">
                    <div class="section">
                        <p style="font-size: 13px; color: #64748b; margin-bottom: 12px;">
                            ä» GitHub URL ä¸‹è½½æ–‡ä»¶ï¼Œæ”¯æŒå…¬å¼€å’Œç§æœ‰ä»“åº“
                        </p>
                        <div class="hint">
                            ğŸ’¡ æ”¯æŒçš„ URL æ ¼å¼ï¼š<br/>
                            1. https://github.com/owner/repo/blob/branch/path/file<br/>
                            2. https://raw.githubusercontent.com/owner/repo/branch/path/file<br/>
                            3. https://api.github.com/repos/owner/repo/contents/path/file
                        </div>
                        <div class="form-group">
                            <label>GitHub æ–‡ä»¶ URL *</label>
                            <input type="text" id="downloadFileUrl" placeholder="ç²˜è´´ GitHub æ–‡ä»¶åœ°å€..." />
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="useTokenForDownload" style="width: auto; margin: 0;" />
                                ä½¿ç”¨ Access Token ï¼ˆç§æœ‰ä»“åº“å¿…é¡»å‹¾é€‰ï¼‰
                            </label>
                        </div>
                        <div class="button-group">
                            <button class="btn-primary" onclick="previewDownloadFile()">
                                ğŸ‘ï¸ é¢„è§ˆæ–‡ä»¶
                            </button>
                            <button class="btn-success" onclick="downloadAndSaveFile()">
                                ğŸ“¥ ä¸‹è½½åˆ°æœ¬åœ°
                            </button>
                        </div>
                        <div id="downloadFileResult" class="result-box" style="display: none;"></div>
                    </div>
                </div>

                <!-- åˆ›å»º/æ›´æ–° Tab -->
                <div id="tab-write" class="tab-content">
                    <div class="section">
                        <div class="form-group">
                            <label>æ–‡ä»¶è·¯å¾„</label>
                            <input type="text" id="updateFilePath" placeholder="è¾“å…¥æ–‡ä»¶è·¯å¾„ï¼Œå¦‚: test_prompts.json" />
                        </div>
                        <div class="form-group">
                            <label>æç¤ºè¯ JSON æ•°æ®</label>
                            <textarea id="promptData" placeholder='è¾“å…¥ JSON æ ¼å¼çš„æç¤ºè¯æ•°æ®...'>{
  "prompts": [
    {
      "id": "test-1",
      "name": "æµ‹è¯•æç¤ºè¯",
      "tag": "test",
      "content": "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æç¤ºè¯",
      "isPinned": false,
      "createdAt": "2024-01-23T00:00:00.000Z",
      "updatedAt": "2024-01-23T00:00:00.000Z"
    }
  ],
  "version": "1.0.0",
  "lastSync": "2024-01-23T00:00:00.000Z"
}</textarea>
                        </div>
                        <div class="button-group">
                            <button class="btn-primary" onclick="testCreateFile()">
                                â• åˆ›å»ºæ–‡ä»¶
                            </button>
                            <button class="btn-warning" onclick="testUpdateFile()">
                                ğŸ”„ æ›´æ–°æ–‡ä»¶
                            </button>
                        </div>
                        <div id="updateFileResult" class="result-box" style="display: none;"></div>
                    </div>
                </div>

                <!-- åŒæ­¥ Tab -->
                <div id="tab-sync" class="tab-content">
                    <div class="section">
                        <p style="font-size: 13px; color: #64748b; margin-bottom: 12px;">
                            æµ‹è¯•åŒå‘åŒæ­¥ï¼šæ¨é€åˆ° GitHub å’Œä» GitHub æ‹‰å–
                        </p>
                        <div class="button-group">
                            <button class="btn-success" onclick="testPullFromGitHub()">
                                ğŸ”½ ä» GitHub æ‹‰å–
                            </button>
                            <button class="btn-primary" onclick="testPushToGitHub()">
                                ğŸ”¼ æ¨é€åˆ° GitHub
                            </button>
                        </div>
                        <div id="syncResult" class="result-box" style="display: none;"></div>
                    </div>
                </div>

                <!-- åˆ é™¤ Tab -->
                <div id="tab-delete" class="tab-content">
                    <div class="section">
                        <div class="hint" style="background: #fef2f2; border-left-color: #ef4444; color: #991b1b;">
                            âš ï¸ è­¦å‘Šï¼šæ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤ GitHub ä¸Šçš„æ–‡ä»¶ï¼Œè¯·è°¨æ…æ“ä½œï¼
                        </div>
                        <div class="form-group">
                            <label>æ–‡ä»¶è·¯å¾„</label>
                            <input type="text" id="deleteFilePath" placeholder="è¾“å…¥è¦åˆ é™¤çš„æ–‡ä»¶è·¯å¾„" />
                        </div>
                        <div class="button-group">
                            <button class="btn-danger" onclick="testDeleteFile()">
                                âŒ åˆ é™¤æ–‡ä»¶
                            </button>
                        </div>
                        <div id="deleteFileResult" class="result-box" style="display: none;"></div>
                    </div>
                </div>

                <!-- ç»¼åˆæµ‹è¯• Tab -->
                <div id="tab-test" class="tab-content">
                    <div class="section">
                        <p style="font-size: 13px; color: #64748b; margin-bottom: 12px;">
                            è‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰ CRUD æ“ä½œçš„å®Œæ•´æµ‹è¯•æµç¨‹
                        </p>
                        <div class="button-group">
                            <button class="btn-primary" onclick="runFullTest()">
                                ğŸš€ è¿è¡Œå®Œæ•´æµ‹è¯•
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å³ä¾§æ—¥å¿—è¾¹æ  -->
        <div class="right-sidebar">
            <div class="log-sidebar">
                <div class="log-header">
                    <div class="log-title">ğŸ“‹ æ“ä½œæ—¥å¿—</div>
                    <button class="btn-secondary" style="padding: 6px 12px; font-size: 12px;" onclick="clearLogs()">
                        ğŸ—‘ï¸ æ¸…ç©º
                    </button>
                </div>
                <div id="logContainer" class="log-container">
                    <div class="log-entry log-info">
                        <span class="log-time">[ç­‰å¾…]</span>
                        <span>è¯·å…ˆé…ç½® GitHub ä¿¡æ¯å¹¶åˆå§‹åŒ–...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥ github_api.js è„šæœ¬ -->
    <script src="github_api.js">
        const githubAPI = new GitHubAPI();
    </script>

    <!-- æµ‹è¯•åŠŸèƒ½è„šæœ¬ -->
    <script>
        let currentSha = null;

        // Tab åˆ‡æ¢åŠŸèƒ½
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰ tab å†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰ tab æŒ‰é’®çš„æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºç›®æ ‡ tab å†…å®¹
            const targetContent = document.getElementById(`tab-${tabName}`);
            if (targetContent) {
                targetContent.classList.add('active');
            }
            
            // æ¿€æ´»ç‚¹å‡»çš„ tab æŒ‰é’®
            const clickedTab = Array.from(document.querySelectorAll('.tab')).find(tab => {
                return tab.textContent.includes({
                    'config': 'é…ç½®ä¿¡æ¯',
                    'files': 'æ–‡ä»¶æµè§ˆ',
                    'read': 'æŸ¥è¯¢åŠŸèƒ½',
                    'download': 'ä¸‹è½½æ–‡ä»¶',
                    'write': 'åˆ›å»º/æ›´æ–°',
                    'sync': 'åŒæ­¥åŠŸèƒ½',
                    'delete': 'åˆ é™¤åŠŸèƒ½',
                    'test': 'ç»¼åˆæµ‹è¯•'
                }[tabName]);
            });
            if (clickedTab) {
                clickedTab.classList.add('active');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨å°è¯•åŠ è½½å·²ä¿å­˜çš„é…ç½®
        window.addEventListener('load', async () => {
            const hasConfig = await githubAPI.loadConfig();
            if (hasConfig && githubAPI.config && githubAPI.config.accessToken) {
                document.getElementById('accessToken').value = githubAPI.config.accessToken;
                if (githubAPI.config.owner) {
                    document.getElementById('owner').value = githubAPI.config.owner;
                    document.getElementById('repo').value = githubAPI.config.repo || '';
                    document.getElementById('branch').value = githubAPI.config.branch || 'master';
                    document.getElementById('filePath').value = githubAPI.config.filePath || 'README.md';
                    document.getElementById('repoSection').style.display = 'block';
                    logMessage('âœ… å·²è‡ªåŠ¨åŠ è½½ä¿å­˜çš„é…ç½®', 'success');
                }
            }
        });

        function logMessage(message, type = 'info') {
            console.log(message);
            const logContainer = document.getElementById('logContainer');
            const time = new Date().toLocaleTimeString('zh-CN');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.innerHTML = `<span class="log-time">[${time}]</span><span>${message}</span>`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '<div class="log-entry log-info"><span class="log-time">[æ¸…ç©º]</span><span>æ—¥å¿—å·²æ¸…ç©º</span></div>';
        }

        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.style.borderColor = isError ? '#ef4444' : '#10b981';
            element.style.color = isError ? '#dc2626' : '#059669';
            element.textContent = typeof data === 'object' ? JSON.stringify(data, null, 2) : data;
        }

        async function initConfig() {
            console.log('Initializing config...');
            const accessToken = document.getElementById('accessToken').value.trim();
            const owner = document.getElementById('owner').value.trim();
            const repo = document.getElementById('repo').value.trim();
            const branch = document.getElementById('branch').value.trim() || 'main';
            const filePath = document.getElementById('filePath').value.trim() || 'test_prompts.json';

            if (!accessToken || !owner || !repo) {
                logMessage('âŒ è¯·å¡«å†™å®Œæ•´çš„é…ç½®ä¿¡æ¯ï¼', 'error');
                alert('è¯·å¡«å†™ Access Tokenã€ä»“åº“æ‰€æœ‰è€…å’Œä»“åº“åç§°');
                return;
            }

            try {
                logMessage('ğŸš€ æ­£åœ¨åˆå§‹åŒ–é…ç½®...', 'info');
                await githubAPI.init({ accessToken, owner, repo, branch, filePath });
                logMessage(`âœ… é…ç½®åˆå§‹åŒ–æˆåŠŸï¼ä»“åº“: ${owner}/${repo}, åˆ†æ”¯: ${branch}, æ–‡ä»¶: ${filePath}`, 'success');
            } catch (error) {
                logMessage(`âŒ é…ç½®åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
            }
            console.log('Config initialization complete');
        }

        // æ–°å¢ï¼šä¿å­˜å½“å‰é…ç½®
        async function saveCurrentConfig() {
            const token = document.getElementById('accessToken').value.trim();
            const owner = document.getElementById('owner').value.trim();
            const repo = document.getElementById('repo').value.trim();
            const branch = document.getElementById('branch').value.trim() || 'master';
            const filePath = document.getElementById('filePath').value.trim() || 'README.md';
            
            if (!token) {
                logMessage('âŒ Token ä¸èƒ½ä¸ºç©ºï¼', 'error');
                return;
            }
            
            if (!owner || !repo) {
                logMessage('âŒ è¯·å¡«å†™ä»“åº“æ‰€æœ‰è€…å’Œä»“åº“åç§°ï¼', 'error');
                return;
            }
            
            await githubAPI.init({ accessToken: token, owner, repo, branch, filePath });
            logMessage(`âœ… é…ç½®å·²ä¿å­˜ï¼ä»“åº“: ${owner}/${repo}, åˆ†æ”¯: ${branch}, æ–‡ä»¶: ${filePath}`, 'success');
        }

        // æ–°å¢ï¼šåŠ è½½å·²ä¿å­˜çš„é…ç½®
        async function loadSavedConfig() {
            const hasConfig = await githubAPI.loadConfig();
            if (hasConfig && githubAPI.config) {
                document.getElementById('accessToken').value = githubAPI.config.accessToken || '';
                document.getElementById('owner').value = githubAPI.config.owner || '';
                document.getElementById('repo').value = githubAPI.config.repo || '';
                document.getElementById('branch').value = githubAPI.config.branch || 'master';
                document.getElementById('filePath').value = githubAPI.config.filePath || 'README.md';
                if (githubAPI.config.accessToken) {
                    document.getElementById('repoSection').style.display = 'block';
                }
                logMessage('âœ… å·²åŠ è½½ä¿å­˜çš„é…ç½®', 'success');
            } else {
                logMessage('âš ï¸ æ²¡æœ‰æ‰¾åˆ°å·²ä¿å­˜çš„é…ç½®', 'warning');
            }
        }

        // æ–°å¢ï¼šæŸ¥çœ‹ç”¨æˆ·ä»“åº“åˆ—è¡¨
        async function listUserRepos() {
            if (!githubAPI.config || !githubAPI.config.accessToken) {
                logMessage('âŒ è¯·å…ˆåˆå§‹åŒ–é…ç½®ï¼', 'error');
                return;
            }
            
            try {
                logMessage('ğŸ“š æ­£åœ¨è·å–ä»“åº“åˆ—è¡¨...', 'info');
                const repos = await githubAPI.listRepositories(50);
                logMessage(`âœ… æ‰¾åˆ° ${repos.length} ä¸ªä»“åº“`, 'success');
                showResult('repoListResult', repos);
            } catch (error) {
                logMessage(`âŒ è·å–å¤±è´¥: ${error.message}`, 'error');
                showResult('repoListResult', error.message, true);
            }
        }

        // æ–°å¢ï¼šæŸ¥çœ‹ä»“åº“åˆ†æ”¯åˆ—è¡¨
        async function listRepoBranches() {
            const owner = document.getElementById('owner').value.trim();
            const repo = document.getElementById('repo').value.trim();
            
            if (!owner || !repo) {
                logMessage('âŒ è¯·å…ˆå¡«å†™ä»“åº“æ‰€æœ‰è€…å’Œä»“åº“åç§°ï¼', 'error');
                return;
            }
            
            try {
                logMessage('ğŸŒ¿ æ­£åœ¨è·å–åˆ†æ”¯åˆ—è¡¨...', 'info');
                const branches = await githubAPI.listBranches(owner, repo);
                logMessage(`âœ… æ‰¾åˆ° ${branches.length} ä¸ªåˆ†æ”¯`, 'success');
                showResult('repoListResult', branches);
            } catch (error) {
                logMessage(`âŒ è·å–å¤±è´¥: ${error.message}`, 'error');
                showResult('repoListResult', error.message, true);
            }
        }

        // æ–°å¢ï¼šæµè§ˆä»“åº“æ–‡ä»¶åˆ—è¡¨
        async function browseRepoFiles() {
            // ç›´æ¥ä½¿ç”¨é…ç½®Tabä¸­çš„é…ç½®ä¿¡æ¯
            if (!githubAPI.config || !githubAPI.config.owner || !githubAPI.config.repo) {
                logMessage('âŒ è¯·å…ˆåœ¨é…ç½®Tabä¸­ä¿å­˜ä»“åº“é…ç½®ï¼', 'error');
                return;
            }
            
            const owner = githubAPI.config.owner;
            const repo = githubAPI.config.repo;
            const branch = githubAPI.config.branch || 'master';
            const path = document.getElementById('filesPath').value.trim();
            
            try {
                const pathDisplay = path || 'æ ¹ç›®å½•';
                logMessage(`ğŸ“ æ­£åœ¨è·å–æ–‡ä»¶åˆ—è¡¨: ${owner}/${repo}/${branch}/${pathDisplay}...`, 'info');
                const files = await githubAPI.listFiles(path, owner, repo, branch);
                logMessage(`âœ… æ‰¾åˆ° ${files.length} ä¸ªæ–‡ä»¶/ç›®å½•`, 'success');
                showResult('filesResult', files);
            } catch (error) {
                logMessage(`âŒ è·å–å¤±è´¥: ${error.message}`, 'error');
                showResult('filesResult', error.message, true);
            }
        }

        async function testConnection() {
            const token = document.getElementById('accessToken').value.trim();
            
            if (!token) {
                logMessage('âŒ è¯·å…ˆå¡«å†™ Access Tokenï¼', 'error');
                return;
            }
            
            // ä¸´æ—¶åˆå§‹åŒ–é…ç½®ç”¨äºæµ‹è¯•
            if (!githubAPI.config) {
                await githubAPI.init({ accessToken: token });
            }

            try {
                logMessage('ğŸ”— æ­£åœ¨æµ‹è¯•è¿æ¥...', 'info');
                const isConnected = await githubAPI.testConnection();
                if (isConnected) {
                    logMessage('âœ… GitHub è¿æ¥æµ‹è¯•æˆåŠŸï¼', 'success');
                    
                    // è·å–ç”¨æˆ·ä¿¡æ¯
                    try {
                        const userInfo = await githubAPI.getUserInfo();
                        logMessage(`ğŸ‘¤ ç”¨æˆ·: ${userInfo.login} (${userInfo.name || 'No name'})`, 'info');
                        
                        // è‡ªåŠ¨å±•å¼€ä»“åº“é…ç½®åŒºåŸŸ
                        document.getElementById('repoSection').style.display = 'block';
                        
                        // è‡ªåŠ¨å¡«å……ä»“åº“æ‰€æœ‰è€…
                        if (userInfo.login && !document.getElementById('owner').value) {
                            document.getElementById('owner').value = userInfo.login;
                            logMessage(`âœ… å·²è‡ªåŠ¨å¡«å……ä»“åº“æ‰€æœ‰è€…: ${userInfo.login}`, 'success');
                        }
                    } catch (e) {
                        // å³ä½¿è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥ï¼Œä¹Ÿå±•å¼€é…ç½®åŒºåŸŸ
                        document.getElementById('repoSection').style.display = 'block';
                    }
                } else {
                    logMessage('âŒ GitHub è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ Token', 'error');
                }
            } catch (error) {
                logMessage(`âŒ è¿æ¥æµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        /**
         * è§£æä»“åº“ URL
         */
        function parseRepoUrl() {
            const url = document.getElementById('repoUrl').value.trim();
            
            if (!url) {
                logMessage('âŒ è¯·è¾“å…¥ä»“åº“ URLï¼', 'error');
                return;
            }
            
            try {
                // æ”¯æŒå¤šç§æ ¼å¼ï¼š
                // https://github.com/owner/repo
                // https://github.com/owner/repo.git
                // git@github.com:owner/repo.git
                let owner = '';
                let repo = '';
                
                // HTTPS æ ¼å¼
                const httpsMatch = url.match(/github\.com\/([^\/]+)\/([^\/\.]+)/);
                if (httpsMatch) {
                    owner = httpsMatch[1];
                    repo = httpsMatch[2];
                }
                // SSH æ ¼å¼
                else {
                    const sshMatch = url.match(/git@github\.com:([^\/]+)\/([^\.]+)/);
                    if (sshMatch) {
                        owner = sshMatch[1];
                        repo = sshMatch[2];
                    }
                }
                
                if (owner && repo) {
                    document.getElementById('owner').value = owner;
                    document.getElementById('repo').value = repo;
                    logMessage(`âœ… è§£ææˆåŠŸï¼ä»“åº“: ${owner}/${repo}`, 'success');
                } else {
                    logMessage('âŒ URL æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·è¾“å…¥ GitHub ä»“åº“åœ°å€', 'error');
                }
            } catch (error) {
                logMessage(`âŒ è§£æå¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testGetFile() {
            if (!githubAPI.config) {
                logMessage('âŒ è¯·å…ˆåˆå§‹åŒ–é…ç½®ï¼', 'error');
                return;
            }

            // è·å–æ–‡ä»¶è·¯å¾„
            const filePath = document.getElementById('getFilePath').value.trim();
            if (!filePath) {
                logMessage('âŒ è¯·è¾“å…¥æ–‡ä»¶è·¯å¾„ï¼', 'error');
                return;
            }

            try {
                logMessage(`ğŸ“¥ æ­£åœ¨è·å–æ–‡ä»¶: ${filePath}...`, 'info');
                const result = await githubAPI.getFile(filePath);
                
                if (result.content) {
                    currentSha = result.sha;
                    const fileType = result.isJson ? 'JSON' : 'æ–‡æœ¬';
                    logMessage(`âœ… æ–‡ä»¶è·å–æˆåŠŸï¼SHA: ${result.sha.substring(0, 8)}..., ç±»å‹: ${fileType}`, 'success');
                    
                    // æ ¹æ®æ–‡ä»¶ç±»å‹æ˜¾ç¤ºå†…å®¹
                    if (result.isJson) {
                        showResult('getFileResult', result.content);
                    } else {
                        // é JSON æ–‡ä»¶ï¼Œæ˜¾ç¤ºåŸå§‹æ–‡æœ¬
                        showResult('getFileResult', result.rawContent || result.content);
                    }
                } else {
                    logMessage('âš ï¸ æ–‡ä»¶ä¸å­˜åœ¨', 'warning');
                    showResult('getFileResult', 'æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¯ä»¥åˆ›å»ºæ–°æ–‡ä»¶');
                }
            } catch (error) {
                logMessage(`âŒ è·å–æ–‡ä»¶å¤±è´¥: ${error.message}`, 'error');
                showResult('getFileResult', error.message, true);
            }
        }

        async function testCreateFile() {
            if (!githubAPI.config) {
                logMessage('âŒ è¯·å…ˆåˆå§‹åŒ–é…ç½®ï¼', 'error');
                return;
            }

            // è·å–æ–‡ä»¶è·¯å¾„
            const filePath = document.getElementById('updateFilePath').value.trim();
            if (!filePath) {
                logMessage('âŒ è¯·è¾“å…¥æ–‡ä»¶è·¯å¾„ï¼', 'error');
                return;
            }

            try {
                const dataText = document.getElementById('promptData').value;
                const data = JSON.parse(dataText);
                
                logMessage(`â• æ­£åœ¨åˆ›å»ºæ–‡ä»¶: ${filePath}...`, 'info');
                const result = await githubAPI.updateFile(data, null, `Create ${filePath}`, filePath);
                currentSha = result.sha;
                
                logMessage(`âœ… æ–‡ä»¶åˆ›å»ºæˆåŠŸï¼SHA: ${result.sha.substring(0, 8)}...`, 'success');
                logMessage(`ğŸ“ æ–‡ä»¶åœ°å€: ${result.url}`, 'info');
                showResult('updateFileResult', result);
            } catch (error) {
                logMessage(`âŒ åˆ›å»ºæ–‡ä»¶å¤±è´¥: ${error.message}`, 'error');
                showResult('updateFileResult', error.message, true);
            }
        }

        async function testUpdateFile() {
            if (!githubAPI.config) {
                logMessage('âŒ è¯·å…ˆåˆå§‹åŒ–é…ç½®ï¼', 'error');
                return;
            }

            // è·å–æ–‡ä»¶è·¯å¾„
            const filePath = document.getElementById('updateFilePath').value.trim();
            if (!filePath) {
                logMessage('âŒ è¯·è¾“å…¥æ–‡ä»¶è·¯å¾„ï¼', 'error');
                return;
            }

            if (!currentSha) {
                logMessage('âš ï¸ æ²¡æœ‰ SHAï¼Œå…ˆè·å–æ–‡ä»¶...', 'warning');
                // ä½¿ç”¨åŒä¸€æ–‡ä»¶è·¯å¾„è·å– SHA
                document.getElementById('getFilePath').value = filePath;
                await testGetFile();
                if (!currentSha) {
                    logMessage('âŒ æ— æ³•è·å– SHAï¼Œè¯·å…ˆåˆ›å»ºæ–‡ä»¶', 'error');
                    return;
                }
            }

            try {
                const dataText = document.getElementById('promptData').value;
                // const data = JSON.parse(dataText);
                const data = dataText;
                data.lastSync = new Date().toISOString();
                
                logMessage(`ğŸ”„ æ­£åœ¨æ›´æ–°æ–‡ä»¶: ${filePath}...`, 'info');
                const result = await githubAPI.updateFile(data, currentSha, `Update ${filePath}`, filePath);
                currentSha = result.sha;
                
                logMessage(`âœ… æ–‡ä»¶æ›´æ–°æˆåŠŸï¼æ–° SHA: ${result.sha.substring(0, 8)}...`, 'success');
                showResult('updateFileResult', result);
            } catch (error) {
                logMessage(`âŒ æ›´æ–°æ–‡ä»¶å¤±è´¥: ${error.message}`, 'error');
                showResult('updateFileResult', error.message, true);
            }
        }

        async function testPullFromGitHub() {
            if (!githubAPI.config) {
                logMessage('âŒ è¯·å…ˆåˆå§‹åŒ–é…ç½®ï¼', 'error');
                return;
            }

            try {
                logMessage('ğŸ”½ æ­£åœ¨ä» GitHub æ‹‰å–...', 'info');
                const prompts = await githubAPI.pullFromGitHub();
                
                logMessage(`âœ… æ‹‰å–æˆåŠŸï¼å…± ${prompts.length} æ¡æç¤ºè¯`, 'success');
                showResult('syncResult', prompts);
            } catch (error) {
                logMessage(`âŒ æ‹‰å–å¤±è´¥: ${error.message}`, 'error');
                showResult('syncResult', error.message, true);
            }
        }

        async function testPushToGitHub() {
            if (!githubAPI.config) {
                logMessage('âŒ è¯·å…ˆåˆå§‹åŒ–é…ç½®ï¼', 'error');
                return;
            }

            try {
                const dataText = document.getElementById('promptData').value;
                const data = JSON.parse(dataText);
                
                logMessage('ğŸ”¼ æ­£åœ¨æ¨é€åˆ° GitHub...', 'info');
                const result = await githubAPI.syncToGitHub(data.prompts);
                currentSha = result.sha;
                
                logMessage(`âœ… æ¨é€æˆåŠŸï¼SHA: ${result.sha.substring(0, 8)}...`, 'success');
                showResult('syncResult', result);
            } catch (error) {
                logMessage(`âŒ æ¨é€å¤±è´¥: ${error.message}`, 'error');
                showResult('syncResult', error.message, true);
            }
        }

        async function testDeleteFile() {
            if (!githubAPI.config) {
                logMessage('âŒ è¯·å…ˆåˆå§‹åŒ–é…ç½®ï¼', 'error');
                return;
            }

            // è·å–æ–‡ä»¶è·¯å¾„
            const filePath = document.getElementById('deleteFilePath').value.trim();
            if (!filePath) {
                logMessage('âŒ è¯·è¾“å…¥è¦åˆ é™¤çš„æ–‡ä»¶è·¯å¾„ï¼', 'error');
                return;
            }

            if (!confirm(`âš ï¸ ç¡®å®šè¦åˆ é™¤ GitHub ä¸Šçš„æ–‡ä»¶ "${filePath}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
                logMessage('âŒ ç”¨æˆ·å–æ¶ˆåˆ é™¤æ“ä½œ', 'warning');
                return;
            }

            if (!currentSha) {
                logMessage('âš ï¸ æ²¡æœ‰ SHAï¼Œå…ˆè·å–æ–‡ä»¶...', 'warning');
                document.getElementById('getFilePath').value = filePath;
                await testGetFile();
                if (!currentSha) {
                    logMessage('âŒ æ— æ³•è·å– SHA', 'error');
                    return;
                }
            }

            try {
                logMessage(`ğŸ—‘ï¸ æ­£åœ¨åˆ é™¤æ–‡ä»¶: ${filePath}...`, 'info');
                await githubAPI.deleteFile(currentSha, `Delete ${filePath}`, filePath);
                currentSha = null;
                
                logMessage('âœ… æ–‡ä»¶åˆ é™¤æˆåŠŸï¼', 'success');
                showResult('deleteFileResult', `æ–‡ä»¶ "${filePath}" å·²ä» GitHub åˆ é™¤`);
            } catch (error) {
                logMessage(`âŒ åˆ é™¤æ–‡ä»¶å¤±è´¥: ${error.message}`, 'error');
                showResult('deleteFileResult', error.message, true);
            }
        }

        async function runFullTest() {
            if (!githubAPI.config) {
                logMessage('âŒ è¯·å…ˆåˆå§‹åŒ–é…ç½®ï¼', 'error');
                return;
            }

            logMessage('ğŸ¯ å¼€å§‹è¿è¡Œå®Œæ•´æµ‹è¯•...', 'info');
            logMessage('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
            
            await new Promise(resolve => setTimeout(resolve, 500));

            // 1. æµ‹è¯•è¿æ¥
            logMessage('ğŸ“Œ æ­¥éª¤ 1/5: æµ‹è¯•è¿æ¥', 'info');
            await testConnection();
            await new Promise(resolve => setTimeout(resolve, 1000));

            // 2. è·å–æ–‡ä»¶
            logMessage('ğŸ“Œ æ­¥éª¤ 2/5: è·å–æ–‡ä»¶', 'info');
            await testGetFile();
            await new Promise(resolve => setTimeout(resolve, 1000));

            // 3. åˆ›å»ºæˆ–æ›´æ–°æ–‡ä»¶
            if (currentSha) {
                logMessage('ğŸ“Œ æ­¥éª¤ 3/5: æ›´æ–°æ–‡ä»¶', 'info');
                await testUpdateFile();
            } else {
                logMessage('ğŸ“Œ æ­¥éª¤ 3/5: åˆ›å»ºæ–‡ä»¶', 'info');
                await testCreateFile();
            }
            await new Promise(resolve => setTimeout(resolve, 1000));

            // 4. æ‹‰å–æµ‹è¯•
            logMessage('ğŸ“Œ æ­¥éª¤ 4/5: æ‹‰å–æµ‹è¯•', 'info');
            await testPullFromGitHub();
            await new Promise(resolve => setTimeout(resolve, 1000));

            // 5. æ¨é€æµ‹è¯•
            logMessage('ğŸ“Œ æ­¥éª¤ 5/5: æ¨é€æµ‹è¯•', 'info');
            await testPushToGitHub();

            logMessage('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
            logMessage('ğŸ‰ å®Œæ•´æµ‹è¯•æ‰§è¡Œå®Œæ¯•ï¼', 'success');
        }

        // ==================== ä¸‹è½½æ–‡ä»¶åŠŸèƒ½ ====================
        
        /**
         * é¢„è§ˆä¸‹è½½æ–‡ä»¶
         */
        async function previewDownloadFile() {
            const url = document.getElementById('downloadFileUrl').value.trim();
            const useToken = document.getElementById('useTokenForDownload').checked;
            
            if (!url) {
                logMessage('âŒ è¯·è¾“å…¥ GitHub æ–‡ä»¶ URLï¼', 'error');
                return;
            }
            
            // å¦‚æœéœ€è¦ä½¿ç”¨ Token ä½†æ²¡æœ‰é…ç½®
            if (useToken && (!githubAPI.config || !githubAPI.config.accessToken)) {
                logMessage('âŒ è¯·å…ˆé…ç½® Access Tokenï¼', 'error');
                return;
            }
            
            try {
                logMessage(`ğŸ‘ï¸ æ­£åœ¨é¢„è§ˆæ–‡ä»¶: ${url}...`, 'info');
                const result = await githubAPI.downloadFileFromUrl(url, useToken);
                
                logMessage(`âœ… æ–‡ä»¶é¢„è§ˆæˆåŠŸï¼æ–‡ä»¶å: ${result.fileName}, å¤§å°: ${result.size} bytes`, 'success');
                logMessage(`ğŸ“‹ æ–‡ä»¶ç±»å‹: ${result.isJson ? 'JSON' : 'æ–‡æœ¬'}`, 'info');
                
                // æ˜¾ç¤ºæ–‡ä»¶å†…å®¹
                if (result.isJson) {
                    showResult('downloadFileResult', result.content);
                } else {
                    showResult('downloadFileResult', result.rawContent);
                }
            } catch (error) {
                logMessage(`âŒ é¢„è§ˆå¤±è´¥: ${error.message}`, 'error');
                showResult('downloadFileResult', error.message, true);
            }
        }
        
        /**
         * ä¸‹è½½å¹¶ä¿å­˜æ–‡ä»¶åˆ°æœ¬åœ°
         */
        async function downloadAndSaveFile() {
            const url = document.getElementById('downloadFileUrl').value.trim();
            const useToken = document.getElementById('useTokenForDownload').checked;
            
            if (!url) {
                logMessage('âŒ è¯·è¾“å…¥ GitHub æ–‡ä»¶ URLï¼', 'error');
                return;
            }
            
            // å¦‚æœéœ€è¦ä½¿ç”¨ Token ä½†æ²¡æœ‰é…ç½®
            if (useToken && (!githubAPI.config || !githubAPI.config.accessToken)) {
                logMessage('âŒ è¯·å…ˆé…ç½® Access Tokenï¼', 'error');
                return;
            }
            
            try {
                logMessage(`ğŸ“¥ æ­£åœ¨ä¸‹è½½æ–‡ä»¶: ${url}...`, 'info');
                const result = await githubAPI.downloadFileFromUrl(url, useToken);
                
                logMessage(`âœ… æ–‡ä»¶è·å–æˆåŠŸï¼æ­£åœ¨ä¿å­˜åˆ°æœ¬åœ°...`, 'success');
                
                // ä¿å­˜æ–‡ä»¶åˆ°æœ¬åœ°
                githubAPI.saveFileToLocal(result.content, result.fileName, result.isJson);
                
                logMessage(`ğŸ’¾ æ–‡ä»¶å·²ä¿å­˜: ${result.fileName} (${result.size} bytes)`, 'success');
                showResult('downloadFileResult', `æ–‡ä»¶ "${result.fileName}" å·²æˆåŠŸä¸‹è½½åˆ°æœ¬åœ°ï¼`);
            } catch (error) {
                logMessage(`âŒ ä¸‹è½½å¤±è´¥: ${error.message}`, 'error');
                showResult('downloadFileResult', error.message, true);
            }
        }
    </script>
</body>
</html>
